<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-architect3/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-architect3";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>35 | 如何监控Tomcat的性能？ - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/深入拆解tomcat和jetty/07.模块六性能优化/02" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect3/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>架构师<ul><li><a href="/blog-architect3/持续交付36讲">持续交付36讲</a></li><li><a href="/blog-architect3/容器实战高手课">容器实战高手课</a></li><li><a href="/blog-architect3/ddd实战课">ddd实战课</a></li><li><a href="/blog-architect3/devops实战笔记">devops实战笔记</a></li><li><a href="/blog-architect3/ebpf核心技术与实战">ebpf核心技术与实战</a></li><li><a href="/blog-architect3/深入剖析kubernetes">深入剖析kubernetes</a></li><li><a href="/blog-architect3/openresty从入门到实战">openresty从入门到实战</a></li><li><a href="/blog-architect3/赵成的运维体系管理课">赵成的运维体系管理课</a></li><li><a href="/blog-architect3/性能测试实战30讲">性能测试实战30讲</a></li><li><a href="/blog-architect3/安全攻防技能30讲">安全攻防技能30讲</a></li><li><a href="/blog-architect3/容量保障核心技术与实战">容量保障核心技术与实战</a></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty">深入拆解tomcat和jetty</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect3/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>架构师<ul><li><a href="/blog-architect3/持续交付36讲">持续交付36讲</a></li><li><a href="/blog-architect3/容器实战高手课">容器实战高手课</a></li><li><a href="/blog-architect3/ddd实战课">ddd实战课</a></li><li><a href="/blog-architect3/devops实战笔记">devops实战笔记</a></li><li><a href="/blog-architect3/ebpf核心技术与实战">ebpf核心技术与实战</a></li><li><a href="/blog-architect3/深入剖析kubernetes">深入剖析kubernetes</a></li><li><a href="/blog-architect3/openresty从入门到实战">openresty从入门到实战</a></li><li><a href="/blog-architect3/赵成的运维体系管理课">赵成的运维体系管理课</a></li><li><a href="/blog-architect3/性能测试实战30讲">性能测试实战30讲</a></li><li><a href="/blog-architect3/安全攻防技能30讲">安全攻防技能30讲</a></li><li><a href="/blog-architect3/容量保障核心技术与实战">容量保障核心技术与实战</a></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty">深入拆解tomcat和jetty</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-architect3/深入拆解tomcat和jetty">深入拆解tomcat和jetty</a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/01.开篇词">01.开篇词</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/01.开篇词/01"><span>开篇词 | Java程序员如何快速成长？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础">02.模块一必备基础</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/01"><span>01 | Web容器学习路径</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/02"><span>02 | HTTP协议必知必会</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/03"><span>03 | 你应该知道的Servlet规范和Servlet容器</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/04"><span>04 | 实战：纯手工打造和运行一个Servlet</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构">03.模块二整体架构</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/01"><span>05 | Tomcat系统架构（上）： 连接器是如何设计的？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/02"><span>06 | Tomcat系统架构（下）：聊聊多层容器的设计</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/03"><span>07 | Tomcat如何实现一键式启停？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/04"><span>08 | Tomcat的“高层们”都负责做什么？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/05"><span>09 | 比较：Jetty架构特点之Connector组件</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/06"><span>10 | 比较：Jetty架构特点之Handler组件</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/07"><span>11 | 总结：从Tomcat和Jetty中提炼组件化设计规范</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/08"><span>12 | 实战：优化并提高Tomcat启动速度</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/09"><span>13 | 热点问题答疑（1）：如何学习源码？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器">04.模块三连接器</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/01"><span>14 | NioEndpoint组件：Tomcat如何实现非阻塞I/O？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/02"><span>15 | Nio2Endpoint组件：Tomcat如何实现异步I/O？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/03"><span>16 | AprEndpoint组件：Tomcat APR提高I/O性能的秘密</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/04"><span>17 | Executor组件：Tomcat如何扩展Java线程池？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/05"><span>18 | 新特性：Tomcat如何支持WebSocket？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/06"><span>19 | 比较：Jetty的线程策略EatWhatYouKill</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/07"><span>20 | 总结：Tomcat和Jetty中的对象池技术</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/08"><span>21 | 总结：Tomcat和Jetty的高性能、高并发之道</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/09"><span>22 | 热点问题答疑（2）：内核如何阻塞与唤醒进程？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器">05.模块四容器</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/01"><span>23 | Host容器：Tomcat如何实现热部署和热加载？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/02"><span>24 | Context容器（上）：Tomcat如何打破双亲委托机制？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/03"><span>25 | Context容器（中）：Tomcat如何隔离Web应用？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/04"><span>26 | Context容器（下）：Tomcat如何实现Servlet规范？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/05"><span>27 | 新特性：Tomcat如何支持异步Servlet？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/06"><span>28 | 新特性：Spring Boot如何使用内嵌式的Tomcat和Jetty？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/07"><span>29 | 比较：Jetty如何实现具有上下文信息的责任链？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/08"><span>30 | 热点问题答疑（3）：Spring框架中的设计模式</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件">06.模块五通用组件</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/01"><span>31 | Logger组件：Tomcat的日志框架及实战</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/02"><span>32 | Manager组件：Tomcat的Session管理机制解析</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03"><span>33 | Cluster组件：Tomcat的集群通信原理</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/04"><span>特别放送 | 如何持续保持对学习的兴趣？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化">07.模块六性能优化</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/01"><span>34 | JVM GC原理及调优的基本思路</span></a></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02"><span>35 | 如何监控Tomcat的性能？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/03"><span>36 | Tomcat I/O和线程池的并发调优</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/04"><span>37 | Tomcat内存溢出的原因分析及调优</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/05"><span>38 | Tomcat拒绝连接原因分析及网络优化</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/06"><span>39 | Tomcat进程占用CPU过高怎么办？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/07"><span>40 | 谈谈Jetty性能调优的思路</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/08"><span>41 | 热点问题答疑（4）： Tomcat和Jetty有哪些不同？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/08.结束语">08.结束语</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/08.结束语/01"><span>结束语 | 静下心来，品味经典</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/08.结束语/02"><span>结课测试 | 这些Tomcat&amp;Jetty的知识你都掌握了吗？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/summary">深入拆解tomcat和jetty</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="Tomcat的关键指标" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#tomcat的关键指标"><span>Tomcat的关键指标</span></a></li><li title="通过JConsole监控Tomcat" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#通过jconsole监控tomcat"><span>通过JConsole监控Tomcat</span></a></li><li title="命令行查看Tomcat指标" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#命令行查看tomcat指标"><span>命令行查看Tomcat指标</span></a></li><li title="实战案例" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#实战案例"><span>实战案例</span></a></li><li title="本期精华" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#本期精华"><span>本期精华</span></a></li><li title="课后思考" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#课后思考"><span>课后思考</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="35--如何监控tomcat的性能"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#35--如何监控tomcat的性能"><span class="icon icon-link"></span></a>35 | 如何监控Tomcat的性能？</h1><p>专栏上一期我们分析了JVM GC的基本原理以及监控和分析工具，今天我们接着来聊如何监控Tomcat的各种指标，因为只有我们掌握了这些指标和信息，才能对Tomcat内部发生的事情一目了然，让我们明白系统的瓶颈在哪里，进而做出调优的决策。</p><p>在今天的文章里，我们首先来看看到底都需要监控Tomcat哪些关键指标，接着来具体学习如何通过JConsole来监控它们。如果系统没有暴露JMX接口，我们还可以通过命令行来查看Tomcat的性能指标。</p><p>Web应用的响应时间是我们关注的一个重点，最后我们通过一个实战案例，来看看Web应用的下游服务响应时间比较长的情况下，Tomcat的各项指标是什么样子的。</p><h2 id="tomcat的关键指标"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#tomcat的关键指标"><span class="icon icon-link"></span></a>Tomcat的关键指标</h2><p>Tomcat的关键指标有<strong>吞吐量、响应时间、错误数、线程池、CPU以及JVM内存</strong>。</p><p>我来简单介绍一下这些指标背后的意义。其中前三个指标是我们最关心的业务指标，Tomcat作为服务器，就是要能够又快有好地处理请求，因此吞吐量要大、响应时间要短，并且错误数要少。</p><p>而后面三个指标是跟系统资源有关的，当某个资源出现瓶颈就会影响前面的业务指标，比如线程池中的线程数量不足会影响吞吐量和响应时间；但是线程数太多会耗费大量CPU，也会影响吞吐量；当内存不足时会触发频繁地GC，耗费CPU，最后也会反映到业务指标上来。</p><p>那如何监控这些指标呢？Tomcat可以通过JMX将上述指标暴露出来的。JMX（Java Management Extensions，即Java管理扩展）是一个为应用程序、设备、系统等植入监控管理功能的框架。JMX使用管理MBean来监控业务资源，这些MBean在JMX MBean服务器上注册，代表JVM中运行的应用程序或服务。每个MBean都有一个属性列表。JMX客户端可以连接到MBean Server来读写MBean的属性值。你可以通过下面这张图来理解一下JMX的工作原理：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage716b714fa2e12380122599be077c10375a6b.f2040923.png" alt=""/></p><p>Tomcat定义了一系列MBean来对外暴露系统状态，接下来我们来看看如何通过JConsole来监控这些指标。</p><h2 id="通过jconsole监控tomcat"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#通过jconsole监控tomcat"><span class="icon icon-link"></span></a>通过JConsole监控Tomcat</h2><p>首先我们需要开启JMX的远程监听端口，具体来说就是设置若干JVM参数。我们可以在Tomcat的bin目录下新建一个名为<code>setenv.sh</code>的文件（或者<code>setenv.bat</code>，根据你的操作系统类型），然后输入下面的内容：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">export JAVA_OPTS=&quot;${JAVA_OPTS} -Dcom.sun.management.jmxremote&quot;</span></div><div class="token-line"><span class="token plain">    export JAVA_OPTS=&quot;${JAVA_OPTS} -Dcom.sun.management.jmxremote.port=9001&quot;</span></div><div class="token-line"><span class="token plain">    export JAVA_OPTS=&quot;${JAVA_OPTS} -Djava.rmi.server.hostname=x.x.x.x&quot;</span></div><div class="token-line"><span class="token plain">    export JAVA_OPTS=&quot;${JAVA_OPTS} -Dcom.sun.management.jmxremote.ssl=false&quot;</span></div><div class="token-line"><span class="token plain">    export JAVA_OPTS=&quot;${JAVA_OPTS} -Dcom.sun.management.jmxremote.authenticate=false&quot;</span></div></pre></div><p>重启Tomcat，这样JMX的监听端口9001就开启了，接下来通过JConsole来连接这个端口。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">jconsole x.x.x.x:9001</span></div></pre></div><p>我们可以看到JConsole的主界面：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage80d780f14c4bd4eead05f4d84937ed7726d7.8f916cc0.png" alt=""/></p><p>前面我提到的需要监控的关键指标有<strong>吞吐量、响应时间、错误数、线程池、CPU以及JVM内存</strong>，接下来我们就来看看怎么在JConsole上找到这些指标。</p><p><strong>吞吐量、响应时间、错误数</strong></p><p>在MBeans标签页下选择GlobalRequestProcessor，这里有Tomcat请求处理的统计信息。你会看到Tomcat中的各种连接器，展开“http-nio-8080”，你会看到这个连接器上的统计信息，其中maxTime表示最长的响应时间，processingTime表示平均响应时间，requestCount表示吞吐量，errorCount就是错误数。</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimageff9cff0a9163fbeeed8eb84ed89c3f71799c.ae91e568.png" alt=""/></p><p><strong>线程池</strong></p><p>选择“线程”标签页，可以看到当前Tomcat进程中有多少线程，如下图所示：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage78b878858a3264107e1f1a0b6a78d43113b8.a207492b.png" alt=""/></p><p>图的左下方是线程列表，右边是线程的运行栈，这些都是非常有用的信息。如果大量线程阻塞，通过观察线程栈，能看到线程阻塞在哪个函数，有可能是I/O等待，或者是死锁。</p><p><strong>CPU</strong></p><p>在主界面可以找到CPU使用率指标，请注意这里的CPU使用率指的是Tomcat进程占用的CPU，不是主机总的CPU使用率。</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage1b9f1bb88cc3d5f2b9a80377a29b0b80e19f.164528bc.png" alt=""/></p><p><strong>JVM内存</strong></p><p>选择“内存”标签页，你能看到Tomcat进程的JVM内存使用情况。</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimagef202f22eca547ca76eb5edba03b39082fa02.bb4de19d.png" alt=""/></p><p>你还可以查看JVM各内存区域的使用情况，大的层面分堆区和非堆区。堆区里有分为Eden、Survivor和Old。选择“VM Summary”标签，可以看到虚拟机内的详细信息。</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimagecca0cc91bb5b7b8d8b0b46dad946617b01a0.5ecf3292.png" alt=""/></p><h2 id="命令行查看tomcat指标"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#命令行查看tomcat指标"><span class="icon icon-link"></span></a>命令行查看Tomcat指标</h2><p>极端情况下如果Web应用占用过多CPU或者内存，又或者程序中发生了死锁，导致Web应用对外没有响应，监控系统上看不到数据，这个时候需要我们登陆到目标机器，通过命令行来查看各种指标。</p><p>1.首先我们通过ps命令找到Tomcat进程，拿到进程ID。</p><p><img src="data:image/png;base64,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" alt=""/></p><p>2.接着查看进程状态的大致信息，通过<code>cat/proc/&lt;pid&gt;/status</code>命令：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimaged8b3d812ac93be2ac882e689f77e5d8e12b3.f18ebc28.png" alt=""/></p><p>3.监控进程的CPU和内存资源使用情况：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage6ed66e7e0730e92e3d8846f37ea8a14973d6.728c3139.png" alt=""/></p><p>4.查看Tomcat的网络连接，比如Tomcat在8080端口上监听连接请求，通过下面的命令查看连接列表：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage146114ba365d585f0ec79543efc1a9b32961.d99b3a17.png" alt=""/></p><p>你还可以分别统计处在“已连接”状态和“TIME_WAIT”状态的连接数：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimageaa2caaab0fb1156bb8ec92ee6c02b149cf2c.33855cf6.jpg" alt=""/></p><p>5.通过ifstat来查看网络流量，大致可以看出Tomcat当前的请求数和负载状况。</p><p><img src="data:image/png;base64,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" alt=""/></p><h2 id="实战案例"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#实战案例"><span class="icon icon-link"></span></a>实战案例</h2><p>在这个实战案例中，我们会创建一个Web应用，根据传入的参数latency来休眠相应的秒数，目的是模拟当前的Web应用在访问下游服务时遇到的延迟。然后用JMeter来压测这个服务，通过JConsole来观察Tomcat的各项指标，分析和定位问题。</p><p>主要的步骤有：</p><p>1.创建一个Spring Boot程序，加入下面代码所示的一个RestController：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">@RestController</span></div><div class="token-line"><span class="token plain">    public class DownStreamLatency {</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        @RequestMapping(&quot;/greeting/latency/{seconds}&quot;)</span></div><div class="token-line"><span class="token plain">        public Greeting greeting(@PathVariable long seconds) {</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">            try {</span></div><div class="token-line"><span class="token plain">                Thread.sleep(seconds * 1000);</span></div><div class="token-line"><span class="token plain">            } catch (InterruptedException e) {</span></div><div class="token-line"><span class="token plain">                e.printStackTrace();</span></div><div class="token-line"><span class="token plain">            }</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">            Greeting greeting = new Greeting(&quot;Hello World!&quot;);</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">            return greeting;</span></div><div class="token-line"><span class="token plain">        }</span></div><div class="token-line"><span class="token plain">    }</span></div></pre></div><p>从上面的代码我们看到，程序会读取URL传过来的seconds参数，先休眠相应的秒数，再返回请求。这样做的目的是，客户端压测工具能够控制服务端的延迟。</p><p>为了方便观察Tomcat的线程数跟延迟之间的关系，还需要加大Tomcat的最大线程数，我们可以在<code>application.properties</code>文件中加入这样一行：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">server.tomcat.max-threads=1000server.tomcat.max-threads=1000</span></div></pre></div><p>2.启动JMeter开始压测，这里我们将压测的线程数设置为100：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage8951895c7c986d0c86b0a869a604c9c6af51.fac3ba72.png" alt=""/></p><p>请你注意的是，我们还需要将客户端的Timeout设置为1000毫秒，这是因为JMeter的测试线程在收到响应之前，不会发出下一次请求，这就意味我们没法按照固定的吞吐量向服务端加压。而加了Timeout以后，JMeter会有固定的吞吐量向Tomcat发送请求。</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage3ea53e275c10132680995ac83460f29a1aa5.0f181298.png" alt=""/></p><p>3.开启测试，这里分三个阶段，第一个阶段将服务端休眠时间设为2秒，然后暂停一段时间。第二和第三阶段分别将休眠时间设置成4秒和6秒。</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimage8b0d8b071d99cbf8875c138f14bd17f0ed0d.6f13bdd3.png" alt=""/></p><p>4.最后我们通过JConsole来观察结果：</p><p><img src="/blog-architect3/static/httpsstatic001geekbangorgresourceimageddb3ddb8609042469ee73ddc3fb68f676eb3.dc2d4e62.png" alt=""/></p><p>下面我们从线程数、内存和CPU这三个指标来分析Tomcat的性能问题。</p><ul><li>首先看线程数，在第一阶段时间之前，线程数大概是40，第一阶段压测开始后，线程数增长到250。为什么是250呢？这是因为JMeter每秒会发出100个请求，每一个请求休眠2秒，因此Tomcat需要200个工作线程来干活；此外Tomcat还有一些其他线程用来处理网络通信和后台任务，所以总数是250左右。第一阶段压测暂停后，线程数又下降到40，这是因为线程池会回收空闲线程。第二阶段测试开始后，线程数涨到了420，这是因为每个请求休眠了4秒；同理，我们看到第三阶段测试的线程数是620。</li><li>我们再来看CPU，在三个阶段的测试中，CPU的峰值始终比较稳定，这是因为JMeter控制了总体的吞吐量，因为服务端用来处理这些请求所需要消耗的CPU基本也是一样的。</li><li>各测试阶段的内存使用量略有增加，这是因为线程数增加了，创建线程也需要消耗内存。</li></ul><p>从上面的测试结果我们可以得出一个结论：对于一个Web应用来说，下游服务的延迟越大，Tomcat所需要的线程数越多，但是CPU保持稳定。所以如果你在实际工作碰到线程数飙升但是CPU没有增加的情况，这个时候你需要怀疑，你的Web应用所依赖的下游服务是不是出了问题，响应时间是否变长了。</p><h2 id="本期精华"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#本期精华"><span class="icon icon-link"></span></a>本期精华</h2><p>今天我们学习了Tomcat中的关键的性能指标以及如何监控这些指标：主要有<strong>吞吐量、响应时间、错误数、线程池、CPU以及JVM内存。</strong></p><p>在实际工作中，我们需要通过观察这些指标来诊断系统遇到的性能问题，找到性能瓶颈。如果我们监控到CPU上升，这时我们可以看看吞吐量是不是也上升了，如果是那说明正常；如果不是的话，可以看看GC的活动，如果GC活动频繁，并且内存居高不下，基本可以断定是内存泄漏。</p><h2 id="课后思考"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02#课后思考"><span class="icon icon-link"></span></a>课后思考</h2><p>请问工作中你如何监控Web应用的健康状态？遇到性能问题的时候是如何做问题定位的呢？</p><p>不知道今天的内容你消化得如何？如果还有疑问，请大胆的在留言区提问，也欢迎你把你的课后思考和心得记录下来，与我和其他同学一起讨论。如果你觉得今天有所收获，欢迎你把它分享给你的朋友。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/深入拆解tomcat和jetty/07.模块六性能优化/02.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 14:48:00</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-architect3/umi.0a9ffe80.js"></script>
  </body>
</html>
