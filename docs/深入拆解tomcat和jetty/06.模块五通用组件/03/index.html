<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-architect3/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-architect3";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>33 | Cluster组件：Tomcat的集群通信原理 - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/深入拆解tomcat和jetty/06.模块五通用组件/03" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect3/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>架构师<ul><li><a href="/blog-architect3/持续交付36讲">持续交付36讲</a></li><li><a href="/blog-architect3/容器实战高手课">容器实战高手课</a></li><li><a href="/blog-architect3/ddd实战课">ddd实战课</a></li><li><a href="/blog-architect3/devops实战笔记">devops实战笔记</a></li><li><a href="/blog-architect3/ebpf核心技术与实战">ebpf核心技术与实战</a></li><li><a href="/blog-architect3/深入剖析kubernetes">深入剖析kubernetes</a></li><li><a href="/blog-architect3/openresty从入门到实战">openresty从入门到实战</a></li><li><a href="/blog-architect3/赵成的运维体系管理课">赵成的运维体系管理课</a></li><li><a href="/blog-architect3/性能测试实战30讲">性能测试实战30讲</a></li><li><a href="/blog-architect3/安全攻防技能30讲">安全攻防技能30讲</a></li><li><a href="/blog-architect3/容量保障核心技术与实战">容量保障核心技术与实战</a></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty">深入拆解tomcat和jetty</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect3/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>架构师<ul><li><a href="/blog-architect3/持续交付36讲">持续交付36讲</a></li><li><a href="/blog-architect3/容器实战高手课">容器实战高手课</a></li><li><a href="/blog-architect3/ddd实战课">ddd实战课</a></li><li><a href="/blog-architect3/devops实战笔记">devops实战笔记</a></li><li><a href="/blog-architect3/ebpf核心技术与实战">ebpf核心技术与实战</a></li><li><a href="/blog-architect3/深入剖析kubernetes">深入剖析kubernetes</a></li><li><a href="/blog-architect3/openresty从入门到实战">openresty从入门到实战</a></li><li><a href="/blog-architect3/赵成的运维体系管理课">赵成的运维体系管理课</a></li><li><a href="/blog-architect3/性能测试实战30讲">性能测试实战30讲</a></li><li><a href="/blog-architect3/安全攻防技能30讲">安全攻防技能30讲</a></li><li><a href="/blog-architect3/容量保障核心技术与实战">容量保障核心技术与实战</a></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty">深入拆解tomcat和jetty</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-architect3/深入拆解tomcat和jetty">深入拆解tomcat和jetty</a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/01.开篇词">01.开篇词</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/01.开篇词/01"><span>开篇词 | Java程序员如何快速成长？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础">02.模块一必备基础</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/01"><span>01 | Web容器学习路径</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/02"><span>02 | HTTP协议必知必会</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/03"><span>03 | 你应该知道的Servlet规范和Servlet容器</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/02.模块一必备基础/04"><span>04 | 实战：纯手工打造和运行一个Servlet</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构">03.模块二整体架构</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/01"><span>05 | Tomcat系统架构（上）： 连接器是如何设计的？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/02"><span>06 | Tomcat系统架构（下）：聊聊多层容器的设计</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/03"><span>07 | Tomcat如何实现一键式启停？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/04"><span>08 | Tomcat的“高层们”都负责做什么？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/05"><span>09 | 比较：Jetty架构特点之Connector组件</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/06"><span>10 | 比较：Jetty架构特点之Handler组件</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/07"><span>11 | 总结：从Tomcat和Jetty中提炼组件化设计规范</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/08"><span>12 | 实战：优化并提高Tomcat启动速度</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/03.模块二整体架构/09"><span>13 | 热点问题答疑（1）：如何学习源码？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器">04.模块三连接器</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/01"><span>14 | NioEndpoint组件：Tomcat如何实现非阻塞I/O？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/02"><span>15 | Nio2Endpoint组件：Tomcat如何实现异步I/O？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/03"><span>16 | AprEndpoint组件：Tomcat APR提高I/O性能的秘密</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/04"><span>17 | Executor组件：Tomcat如何扩展Java线程池？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/05"><span>18 | 新特性：Tomcat如何支持WebSocket？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/06"><span>19 | 比较：Jetty的线程策略EatWhatYouKill</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/07"><span>20 | 总结：Tomcat和Jetty中的对象池技术</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/08"><span>21 | 总结：Tomcat和Jetty的高性能、高并发之道</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/04.模块三连接器/09"><span>22 | 热点问题答疑（2）：内核如何阻塞与唤醒进程？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器">05.模块四容器</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/01"><span>23 | Host容器：Tomcat如何实现热部署和热加载？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/02"><span>24 | Context容器（上）：Tomcat如何打破双亲委托机制？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/03"><span>25 | Context容器（中）：Tomcat如何隔离Web应用？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/04"><span>26 | Context容器（下）：Tomcat如何实现Servlet规范？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/05"><span>27 | 新特性：Tomcat如何支持异步Servlet？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/06"><span>28 | 新特性：Spring Boot如何使用内嵌式的Tomcat和Jetty？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/07"><span>29 | 比较：Jetty如何实现具有上下文信息的责任链？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/05.模块四容器/08"><span>30 | 热点问题答疑（3）：Spring框架中的设计模式</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件">06.模块五通用组件</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/01"><span>31 | Logger组件：Tomcat的日志框架及实战</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/02"><span>32 | Manager组件：Tomcat的Session管理机制解析</span></a></li><li><a aria-current="page" class="active" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03"><span>33 | Cluster组件：Tomcat的集群通信原理</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/04"><span>特别放送 | 如何持续保持对学习的兴趣？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化">07.模块六性能优化</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/01"><span>34 | JVM GC原理及调优的基本思路</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/02"><span>35 | 如何监控Tomcat的性能？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/03"><span>36 | Tomcat I/O和线程池的并发调优</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/04"><span>37 | Tomcat内存溢出的原因分析及调优</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/05"><span>38 | Tomcat拒绝连接原因分析及网络优化</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/06"><span>39 | Tomcat进程占用CPU过高怎么办？</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/07"><span>40 | 谈谈Jetty性能调优的思路</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/07.模块六性能优化/08"><span>41 | 热点问题答疑（4）： Tomcat和Jetty有哪些不同？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/08.结束语">08.结束语</a><ul><li><a href="/blog-architect3/深入拆解tomcat和jetty/08.结束语/01"><span>结束语 | 静下心来，品味经典</span></a></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/08.结束语/02"><span>结课测试 | 这些Tomcat&amp;Jetty的知识你都掌握了吗？</span></a></li></ul></li><li><a href="/blog-architect3/深入拆解tomcat和jetty/summary">深入拆解tomcat和jetty</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="集群通信原理" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#集群通信原理"><span>集群通信原理</span></a></li><li title="集群通信配置" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#集群通信配置"><span>集群通信配置</span></a></li><li title="集群工作过程" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#集群工作过程"><span>集群工作过程</span></a></li><li title="本期精华" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#本期精华"><span>本期精华</span></a></li><li title="课后思考" data-depth="2"><a href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#课后思考"><span>课后思考</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="33--cluster组件tomcat的集群通信原理"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#33--cluster组件tomcat的集群通信原理"><span class="icon icon-link"></span></a>33 | Cluster组件：Tomcat的集群通信原理</h1><p>为了支持水平扩展和高可用，Tomcat提供了集群部署的能力，但与此同时也带来了分布式系统的一个通用问题，那就是如何在集群中的多个节点之间保持数据的一致性，比如会话（Session）信息。</p><p>要实现这一点，基本上有两种方式，一种是把所有Session数据放到一台服务器或者一个数据库中，集群中的所有节点通过访问这台Session服务器来获取数据。另一种方式就是在集群中的节点间进行Session数据的同步拷贝，这里又分为两种策略：第一种是将一个节点的Session拷贝到集群中其他所有节点；第二种是只将一个节点上的Session数据拷贝到另一个备份节点。</p><p>对于Tomcat的Session管理来说，这两种方式都支持。今天我们就来看看第二种方式的实现原理，也就是Tomcat集群通信的原理和配置方法，最后通过官网上的一个例子来了解下Tomcat集群到底是如何工作的。</p><h2 id="集群通信原理"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#集群通信原理"><span class="icon icon-link"></span></a>集群通信原理</h2><p>要实现集群通信，首先要知道集群中都有哪些成员。Tomcat是通过<strong>组播</strong>（Multicast）来实现的。那什么是组播呢？为了理解组播，我先来说说什么是“单播”。网络节点之间的通信就好像是人们之间的对话一样，一个人对另外一个人说话，此时信息的接收和传递只在两个节点之间进行，比如你在收发电子邮件、浏览网页时，使用的就是单播，也就是我们熟悉的“点对点通信”。</p><p>如果一台主机需要将同一个消息发送多个主机逐个传输，效率就会比较低，于是就出现组播技术。组播是<strong>一台主机向指定的一组主机发送数据报包</strong>，组播通信的过程是这样的：每一个Tomcat节点在启动时和运行时都会周期性（默认500毫秒）发送组播心跳包，同一个集群内的节点都在相同的<strong>组播地址</strong>和<strong>端口</strong>监听这些信息；在一定的时间内（默认3秒）不发送<strong>组播报文</strong>的节点就会被认为已经崩溃了，会从集群中删去。因此通过组播，集群中每个成员都能维护一个集群成员列表。</p><h2 id="集群通信配置"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#集群通信配置"><span class="icon icon-link"></span></a>集群通信配置</h2><p>有了集群成员的列表，集群中的节点就能通过TCP连接向其他节点传输Session数据。Tomcat通过SimpleTcpCluster类来进行会话复制（In-Memory Replication）。要开启集群功能，只需要将<code>server.xml</code>里的这一行的注释去掉就行：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>变成这样：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>虽然只是简单的一行配置，但这一行配置等同于下面这样的配置，也就是说Tomcat给我们设置了很多默认参数，这些参数都跟集群通信有关。</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&lt;!-- </span></div><div class="token-line"><span class="token plain">      SimpleTcpCluster是用来复制Session的组件。复制Session有同步和异步两种方式：</span></div><div class="token-line"><span class="token plain">      同步模式下，向浏览器的发送响应数据前，需要先将Session拷贝到其他节点完；</span></div><div class="token-line"><span class="token plain">      异步模式下，无需等待Session拷贝完成就可响应。异步模式更高效，但是同步模式</span></div><div class="token-line"><span class="token plain">      可靠性更高。</span></div><div class="token-line"><span class="token plain">      同步异步模式由channelSendOptions参数控制，默认值是8，为异步模式；4是同步模式。</span></div><div class="token-line"><span class="token plain">      在异步模式下，可以通过加上&quot;拷贝确认&quot;（Acknowledge）来提高可靠性，此时</span></div><div class="token-line"><span class="token plain">      channelSendOptions设为10</span></div><div class="token-line"><span class="token plain">    --&gt;</span></div><div class="token-line"><span class="token plain">    &lt;Cluster className=&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;</span></div><div class="token-line"><span class="token plain">                     channelSendOptions=&quot;8&quot;&gt;</span></div><div class="token-line"><span class="token plain">       &lt;!--</span></div><div class="token-line"><span class="token plain">        Manager决定如何管理集群的Session信息。</span></div><div class="token-line"><span class="token plain">        Tomcat提供了两种Manager：BackupManager和DeltaManager。</span></div><div class="token-line"><span class="token plain">        BackupManager－集群下的某一节点的Session，将复制到一个备份节点。</span></div><div class="token-line"><span class="token plain">        DeltaManager－ 集群下某一节点的Session，将复制到所有其他节点。</span></div><div class="token-line"><span class="token plain">        DeltaManager是Tomcat默认的集群Manager。</span></div><div class="token-line"><span class="token plain">        </span></div><div class="token-line"><span class="token plain">        expireSessionsOnShutdown－设置为true时，一个节点关闭时，</span></div><div class="token-line"><span class="token plain">        将导致集群下的所有Session失效</span></div><div class="token-line"><span class="token plain">        notifyListenersOnReplication－集群下节点间的Session复制、</span></div><div class="token-line"><span class="token plain">        删除操作，是否通知session listeners</span></div><div class="token-line"><span class="token plain">        </span></div><div class="token-line"><span class="token plain">        maxInactiveInterval－集群下Session的有效时间(单位:s)。</span></div><div class="token-line"><span class="token plain">        maxInactiveInterval内未活动的Session，将被Tomcat回收。</span></div><div class="token-line"><span class="token plain">        默认值为1800(30min)</span></div><div class="token-line"><span class="token plain">      --&gt;</span></div><div class="token-line"><span class="token plain">      &lt;Manager className=&quot;org.apache.catalina.ha.session.DeltaManager&quot;</span></div><div class="token-line"><span class="token plain">                       expireSessionsOnShutdown=&quot;false&quot;</span></div><div class="token-line"><span class="token plain">                       notifyListenersOnReplication=&quot;true&quot;/&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">       &lt;!--</span></div><div class="token-line"><span class="token plain">        Channel是Tomcat节点之间进行通讯的工具。</span></div><div class="token-line"><span class="token plain">        Channel包括5个组件：Membership、Receiver、Sender、</span></div><div class="token-line"><span class="token plain">        Transport、Interceptor</span></div><div class="token-line"><span class="token plain">       --&gt;</span></div><div class="token-line"><span class="token plain">      &lt;Channel className=&quot;org.apache.catalina.tribes.group.GroupChannel&quot;&gt;</span></div><div class="token-line"><span class="token plain">         &lt;!--</span></div><div class="token-line"><span class="token plain">          Membership维护集群的可用节点列表。它可以检查到新增的节点，</span></div><div class="token-line"><span class="token plain">          也可以检查没有心跳的节点</span></div><div class="token-line"><span class="token plain">          className－指定Membership使用的类</span></div><div class="token-line"><span class="token plain">          address－组播地址</span></div><div class="token-line"><span class="token plain">          port－组播端口</span></div><div class="token-line"><span class="token plain">          frequency－发送心跳(向组播地址发送UDP数据包)的时间间隔(单位:ms)。</span></div><div class="token-line"><span class="token plain">          dropTime－Membership在dropTime(单位:ms)内未收到某一节点的心跳，</span></div><div class="token-line"><span class="token plain">          则将该节点从可用节点列表删除。默认值为3000。</span></div><div class="token-line"><span class="token plain">         --&gt;</span></div><div class="token-line"><span class="token plain">         &lt;Membership  className=&quot;org.apache.catalina.tribes.membership.</span></div><div class="token-line"><span class="token plain">             McastService&quot;</span></div><div class="token-line"><span class="token plain">             address=&quot;228.0.0.4&quot;</span></div><div class="token-line"><span class="token plain">             port=&quot;45564&quot;</span></div><div class="token-line"><span class="token plain">             frequency=&quot;500&quot;</span></div><div class="token-line"><span class="token plain">             dropTime=&quot;3000&quot;/&gt;</span></div><div class="token-line"><span class="token plain">         </span></div><div class="token-line"><span class="token plain">         &lt;!--</span></div><div class="token-line"><span class="token plain">           Receiver用于各个节点接收其他节点发送的数据。</span></div><div class="token-line"><span class="token plain">           接收器分为两种：BioReceiver(阻塞式)、NioReceiver(非阻塞式)</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">           className－指定Receiver使用的类</span></div><div class="token-line"><span class="token plain">           address－接收消息的地址</span></div><div class="token-line"><span class="token plain">           port－接收消息的端口</span></div><div class="token-line"><span class="token plain">           autoBind－端口的变化区间，如果port为4000，autoBind为100，</span></div><div class="token-line"><span class="token plain">                     接收器将在4000-4099间取一个端口进行监听。</span></div><div class="token-line"><span class="token plain">           selectorTimeout－NioReceiver内Selector轮询的超时时间</span></div><div class="token-line"><span class="token plain">           maxThreads－线程池的最大线程数</span></div><div class="token-line"><span class="token plain">         --&gt;</span></div><div class="token-line"><span class="token plain">         &lt;Receiver className=&quot;org.apache.catalina.tribes.transport.nio.</span></div><div class="token-line"><span class="token plain">             NioReceiver&quot;</span></div><div class="token-line"><span class="token plain">             address=&quot;auto&quot;</span></div><div class="token-line"><span class="token plain">             port=&quot;4000&quot;</span></div><div class="token-line"><span class="token plain">             autoBind=&quot;100&quot;</span></div><div class="token-line"><span class="token plain">             selectorTimeout=&quot;5000&quot;</span></div><div class="token-line"><span class="token plain">             maxThreads=&quot;6&quot;/&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">          &lt;!--</span></div><div class="token-line"><span class="token plain">             Sender用于向其他节点发送数据，Sender内嵌了Transport组件，</span></div><div class="token-line"><span class="token plain">             Transport真正负责发送消息。</span></div><div class="token-line"><span class="token plain">          --&gt;</span></div><div class="token-line"><span class="token plain">          &lt;Sender className=&quot;org.apache.catalina.tribes.transport.</span></div><div class="token-line"><span class="token plain">              ReplicationTransmitter&quot;&gt;</span></div><div class="token-line"><span class="token plain">              &lt;!--</span></div><div class="token-line"><span class="token plain">                Transport分为两种：bio.PooledMultiSender(阻塞式)</span></div><div class="token-line"><span class="token plain">                和nio.PooledParallelSender(非阻塞式)，PooledParallelSender</span></div><div class="token-line"><span class="token plain">                是从tcp连接池中获取连接，可以实现并行发送，即集群中的节点可以</span></div><div class="token-line"><span class="token plain">                同时向其他所有节点发送数据而互不影响。</span></div><div class="token-line"><span class="token plain">               --&gt;</span></div><div class="token-line"><span class="token plain">              &lt;Transport className=&quot;org.apache.catalina.tribes.</span></div><div class="token-line"><span class="token plain">              transport.nio.PooledParallelSender&quot;/&gt;     </span></div><div class="token-line"><span class="token plain">           &lt;/Sender&gt;</span></div><div class="token-line"><span class="token plain">           </span></div><div class="token-line"><span class="token plain">           &lt;!--</span></div><div class="token-line"><span class="token plain">             Interceptor : Cluster的拦截器</span></div><div class="token-line"><span class="token plain">             TcpFailureDetector－TcpFailureDetector可以拦截到某个节点关闭</span></div><div class="token-line"><span class="token plain">             的信息，并尝试通过TCP连接到此节点，以确保此节点真正关闭，从而更新集</span></div><div class="token-line"><span class="token plain">             群可用节点列表                 </span></div><div class="token-line"><span class="token plain">            --&gt;</span></div><div class="token-line"><span class="token plain">           &lt;Interceptor className=&quot;org.apache.catalina.tribes.group.</span></div><div class="token-line"><span class="token plain">           interceptors.TcpFailureDetector&quot;/&gt;</span></div><div class="token-line"><span class="token plain">           </span></div><div class="token-line"><span class="token plain">           &lt;!--</span></div><div class="token-line"><span class="token plain">             MessageDispatchInterceptor－查看Cluster组件发送消息的</span></div><div class="token-line"><span class="token plain">             方式是否设置为Channel.SEND_OPTIONS_ASYNCHRONOUS，如果是，</span></div><div class="token-line"><span class="token plain">             MessageDispatchInterceptor先将等待发送的消息进行排队，</span></div><div class="token-line"><span class="token plain">             然后将排好队的消息转给Sender。</span></div><div class="token-line"><span class="token plain">            --&gt;</span></div><div class="token-line"><span class="token plain">           &lt;Interceptor className=&quot;org.apache.catalina.tribes.group.</span></div><div class="token-line"><span class="token plain">           interceptors.MessageDispatchInterceptor&quot;/&gt;</span></div><div class="token-line"><span class="token plain">      &lt;/Channel&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">      &lt;!--</span></div><div class="token-line"><span class="token plain">        Valve : Tomcat的拦截器，</span></div><div class="token-line"><span class="token plain">        ReplicationValve－在处理请求前后打日志；过滤不涉及Session变化的请求。                 </span></div><div class="token-line"><span class="token plain">        --&gt;</span></div><div class="token-line"><span class="token plain">      &lt;Valve className=&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span></div><div class="token-line"><span class="token plain">        filter=&quot;&quot;/&gt;</span></div><div class="token-line"><span class="token plain">      &lt;Valve className=&quot;org.apache.catalina.ha.session.</span></div><div class="token-line"><span class="token plain">      JvmRouteBinderValve&quot;/&gt;</span></div><div class="token-line"><span class="token plain">     </span></div><div class="token-line"><span class="token plain">      &lt;!--</span></div><div class="token-line"><span class="token plain">        Deployer用于集群的farm功能，监控应用中文件的更新，以保证集群中所有节点</span></div><div class="token-line"><span class="token plain">        应用的一致性，如某个用户上传文件到集群中某个节点的应用程序目录下，Deployer</span></div><div class="token-line"><span class="token plain">        会监测到这一操作并把文件拷贝到集群中其他节点相同应用的对应目录下以保持</span></div><div class="token-line"><span class="token plain">        所有应用的一致，这是一个相当强大的功能。</span></div><div class="token-line"><span class="token plain">      --&gt;</span></div><div class="token-line"><span class="token plain">      &lt;Deployer className=&quot;org.apache.catalina.ha.deploy.FarmWarDeployer&quot;</span></div><div class="token-line"><span class="token plain">         tempDir=&quot;/tmp/war-temp/&quot;</span></div><div class="token-line"><span class="token plain">         deployDir=&quot;/tmp/war-deploy/&quot;</span></div><div class="token-line"><span class="token plain">         watchDir=&quot;/tmp/war-listen/&quot;</span></div><div class="token-line"><span class="token plain">         watchEnabled=&quot;false&quot;/&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">      &lt;!--</span></div><div class="token-line"><span class="token plain">        ClusterListener : 监听器，监听Cluster组件接收的消息</span></div><div class="token-line"><span class="token plain">        使用DeltaManager时，Cluster接收的信息通过ClusterSessionListener</span></div><div class="token-line"><span class="token plain">        传递给DeltaManager，从而更新自己的Session列表。</span></div><div class="token-line"><span class="token plain">        --&gt;</span></div><div class="token-line"><span class="token plain">      &lt;ClusterListener className=&quot;org.apache.catalina.ha.session.</span></div><div class="token-line"><span class="token plain">      ClusterSessionListener&quot;/&gt;</span></div><div class="token-line"><span class="token plain">      </span></div><div class="token-line"><span class="token plain">    &lt;/Cluster&gt;</span></div></pre></div><p>从上面的的参数列表可以看到，默认情况下Session管理组件DeltaManager会在节点之间拷贝Session，DeltaManager采用的一种all-to-all的工作方式，即集群中的节点会把Session数据向所有其他节点拷贝，而不管其他节点是否部署了当前应用。当集群节点数比较少时，比如少于4个，这种all-to-all的方式是不错的选择；但是当集群中的节点数量比较多时，数据拷贝的开销成指数级增长，这种情况下可以考虑BackupManager，BackupManager只向一个备份节点拷贝数据。</p><p>在大体了解了Tomcat集群实现模型后，就可以对集群作出更优化的配置了。Tomcat推荐了一套配置，使用了比DeltaManager更高效的BackupManager，并且通过ReplicationValve设置了请求过滤。</p><p>这里还请注意在一台服务器部署多个节点时需要修改Receiver的侦听端口，另外为了在节点间高效地拷贝数据，所有Tomcat节点最好采用相同的配置，具体配置如下：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&lt;Cluster className=&quot;org.apache.catalina.ha.tcp.SimpleTcpCluster&quot;</span></div><div class="token-line"><span class="token plain">                     channelSendOptions=&quot;6&quot;&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        &lt;Manager className=&quot;org.apache.catalina.ha.session.BackupManager&quot;</span></div><div class="token-line"><span class="token plain">                       expireSessionsOnShutdown=&quot;false&quot;</span></div><div class="token-line"><span class="token plain">                       notifyListenersOnReplication=&quot;true&quot;</span></div><div class="token-line"><span class="token plain">                       mapSendOptions=&quot;6&quot;/&gt;</span></div><div class="token-line"><span class="token plain">             </span></div><div class="token-line"><span class="token plain">         &lt;Channel className=&quot;org.apache.catalina.tribes.group.</span></div><div class="token-line"><span class="token plain">         GroupChannel&quot;&gt;</span></div><div class="token-line"><span class="token plain">         </span></div><div class="token-line"><span class="token plain">         &lt;Membership className=&quot;org.apache.catalina.tribes.membership.</span></div><div class="token-line"><span class="token plain">         McastService&quot;</span></div><div class="token-line"><span class="token plain">           address=&quot;228.0.0.4&quot;</span></div><div class="token-line"><span class="token plain">           port=&quot;45564&quot;</span></div><div class="token-line"><span class="token plain">           frequency=&quot;500&quot;</span></div><div class="token-line"><span class="token plain">           dropTime=&quot;3000&quot;/&gt;</span></div><div class="token-line"><span class="token plain">           </span></div><div class="token-line"><span class="token plain">         &lt;Receiver className=&quot;org.apache.catalina.tribes.transport.nio.</span></div><div class="token-line"><span class="token plain">         NioReceiver&quot;</span></div><div class="token-line"><span class="token plain">           address=&quot;auto&quot;</span></div><div class="token-line"><span class="token plain">           port=&quot;5000&quot;</span></div><div class="token-line"><span class="token plain">           selectorTimeout=&quot;100&quot;</span></div><div class="token-line"><span class="token plain">           maxThreads=&quot;6&quot;/&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">         &lt;Sender className=&quot;org.apache.catalina.tribes.transport.</span></div><div class="token-line"><span class="token plain">         ReplicationTransmitter&quot;&gt;</span></div><div class="token-line"><span class="token plain">              &lt;Transport className=&quot;org.apache.catalina.tribes.transport.</span></div><div class="token-line"><span class="token plain">              nio.PooledParallelSender&quot;/&gt;</span></div><div class="token-line"><span class="token plain">         &lt;/Sender&gt;</span></div><div class="token-line"><span class="token plain">         </span></div><div class="token-line"><span class="token plain">         &lt;Interceptor className=&quot;org.apache.catalina.tribes.group.</span></div><div class="token-line"><span class="token plain">         interceptors.TcpFailureDetector&quot;/&gt;</span></div><div class="token-line"><span class="token plain">         </span></div><div class="token-line"><span class="token plain">         &lt;Interceptor className=&quot;org.apache.catalina.tribes.group.</span></div><div class="token-line"><span class="token plain">         interceptors.MessageDispatchInterceptor&quot;/&gt;</span></div><div class="token-line"><span class="token plain">         </span></div><div class="token-line"><span class="token plain">         &lt;Interceptor className=&quot;org.apache.catalina.tribes.group.</span></div><div class="token-line"><span class="token plain">         interceptors.ThroughputInterceptor&quot;/&gt;</span></div><div class="token-line"><span class="token plain">       &lt;/Channel&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">       &lt;Valve className=&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span></div><div class="token-line"><span class="token plain">           filter=&quot;.*\.gif|.*\.js|.*\.jpeg|.*\.jpg|.*\.png|.*\</span></div><div class="token-line"><span class="token plain">                   .htm|.*\.html|.*\.css|.*\.txt&quot;/&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">       &lt;Deployer className=&quot;org.apache.catalina.ha.deploy.FarmWarDeployer&quot;</span></div><div class="token-line"><span class="token plain">           tempDir=&quot;/tmp/war-temp/&quot;</span></div><div class="token-line"><span class="token plain">           deployDir=&quot;/tmp/war-deploy/&quot;</span></div><div class="token-line"><span class="token plain">           watchDir=&quot;/tmp/war-listen/&quot;</span></div><div class="token-line"><span class="token plain">           watchEnabled=&quot;false&quot;/&gt;</span></div><div class="token-line"><span class="token plain">    </span></div><div class="token-line"><span class="token plain">        &lt;ClusterListener className=&quot;org.apache.catalina.ha.session.</span></div><div class="token-line"><span class="token plain">        ClusterSessionListener&quot;/&gt;</span></div><div class="token-line"><span class="token plain">    &lt;/Cluster&gt;</span></div></pre></div><h2 id="集群工作过程"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#集群工作过程"><span class="icon icon-link"></span></a>集群工作过程</h2><p>Tomcat的官网给出了一个例子，来说明Tomcat集群模式下是如何工作的，以及Tomcat集群是如何实现高可用的。比如集群由Tomcat A和Tomcat B两个Tomcat实例组成，按照时间先后顺序发生了如下事件：</p><p><strong>1. Tomcat A启动</strong></p><p>Tomcat A启动过程中，当Host对象被创建时，一个Cluster组件（默认是SimpleTcpCluster）被关联到这个Host对象。当某个应用在<code>web.xml</code>中设置了Distributable时，Tomcat将为此应用的上下文环境创建一个DeltaManager。SimpleTcpCluster启动Membership服务和Replication服务。</p><p><strong>2. Tomcat B启动（在Tomcat A之后启动）</strong></p><p>首先Tomcat B会执行和Tomcat A一样的操作，然后SimpleTcpCluster会建立一个由Tomcat A和Tomcat B组成的Membership。接着Tomcat B向集群中的Tomcat A请求Session数据，如果Tomcat A没有响应Tomcat B的拷贝请求，Tomcat B会在60秒后time out。在Session数据拷贝完成之前Tomcat B不会接收浏览器的请求。</p><p><strong>3. Tomcat A接收HTTP请求，创建Session 1</strong></p><p>Tomcat A响应客户请求，在把结果发送回客户端之前，ReplicationValve会拦截当前请求（如果Filter中配置了不需拦截的请求类型，这一步就不会进行，默认配置下拦截所有请求），如果发现当前请求更新了Session，就调用Replication服务建立TCP连接将Session拷贝到Membership列表中的其他节点即Tomcat B。在拷贝时，所有保存在当前Session中的可序列化的对象都会被拷贝，而不仅仅是发生更新的部分。</p><p><strong>4. Tomcat A崩溃</strong></p><p>当Tomcat A崩溃时，Tomcat B会被告知Tomcat A已从集群中退出，然后Tomcat B就会把Tomcat A从自己的Membership列表中删除。并且Tomcat B的Session更新时不再往Tomcat A拷贝，同时负载均衡器会把后续的HTTP请求全部转发给Tomcat B。在此过程中所有的Session数据不会丢失。</p><p><strong>5. Tomcat B接收Tomcat A的请求</strong></p><p>Tomcat B正常响应本应该发往Tomcat A的请求，因为Tomcat B保存了Tomcat A的所有Session数据。</p><p><strong>6. Tomcat A重新启动</strong></p><p>Tomcat A按步骤1、2操作启动，加入集群，并从Tomcat B拷贝所有Session数据，拷贝完成后开始接收请求。</p><p><strong>7. Tomcat A接收请求，Session 1被用户注销</strong></p><p>Tomcat继续接收发往Tomcat A的请求，Session 1设置为失效。请注意这里的失效并非因为Tomcat A处于非活动状态超过设置的时间，而是应用程序执行了注销的操作（比如用户登出）而引起的Session失效。这时Tomcat A向Tomcat B发送一个Session 1 Expired的消息，Tomcat B收到消息后也会把Session 1设置为失效。</p><p><strong>8. Tomcat B接收到一个新请求，创建Session 2</strong></p><p>同理这个新的Session也会被拷贝到Tomcat A。</p><p><strong>9. Tomcat A上的Session 2过期</strong></p><p>因超时原因引起的Session失效Tomcat A无需通知Tomcat B，Tomcat B同样知道Session 2已经超时。因此对于Tomcat集群有一点非常重要，<strong>所有节点的操作系统时间必须一致</strong>。不然会出现某个节点Session已过期而在另一节点此Session仍处于活动状态的现象。</p><h2 id="本期精华"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#本期精华"><span class="icon icon-link"></span></a>本期精华</h2><p>今天我谈了Tomcat的集群工作原理和配置方式，还通过官网上的一个例子说明了Tomcat集群的工作过程。Tomcat集群对Session的拷贝支持两种方式：DeltaManager和BackupManager。</p><p>当集群中节点比较少时，可以采用DeltaManager，因为Session数据在集群中各个节点都有备份，任何一个节点崩溃都不会对整体造成影响，可靠性比较高。</p><p>当集群中节点数比较多时，可以采用BackupManager，这是因为一个节点的Session只会拷贝到另一个节点，数据拷贝的开销比较少，同时只要这两个节点不同时崩溃，Session数据就不会丢失。</p><h2 id="课后思考"><a aria-hidden="true" tabindex="-1" href="/blog-architect3/深入拆解tomcat和jetty/06.模块五通用组件/03#课后思考"><span class="icon icon-link"></span></a>课后思考</h2><p>在Tomcat官方推荐的配置里，ReplicationValve被配置成下面这样：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&lt;Valve className=&quot;org.apache.catalina.ha.tcp.ReplicationValve&quot;</span></div><div class="token-line"><span class="token plain">           filter=&quot;.*\.gif|.*\.js|.*\.jpeg|.*\.jpg|.*\.png|.*\</span></div><div class="token-line"><span class="token plain">                   .htm|.*\.html|.*\.css|.*\.txt&quot;/&gt;</span></div></pre></div><p>你是否注意到，filter的值是一些JS文件或者图片等，这是为什么呢？</p><p>不知道今天的内容你消化得如何？如果还有疑问，请大胆的在留言区提问，也欢迎你把你的课后思考和心得记录下来，与我和其他同学一起讨论。如果你觉得今天有所收获，欢迎你把它分享给你的朋友。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/深入拆解tomcat和jetty/06.模块五通用组件/03.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 14:48:00</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-architect3/umi.0a9ffe80.js"></script>
  </body>
</html>
